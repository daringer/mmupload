<!doctype html>
<head lang=en>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<title>Fancy Uploader Frontend</title>

<script src="{{ url_for("get_static", target="jquery-3.4.1.min.js") }}" type="text/javascript" charset="utf-8"></script>

<style type="text/css" media="screen">
{{ css|safe }}
</style>

</head>
<body>

{% with messages = get_flashed_messages() %}
  {% if messages %}
	<div id=flash class=box>
    {% for message in messages %}
		{{ message }}<br />
		{% endfor %}
  {% endif %}
 </div>
{% endwith %}


{% if show_upload %}
<div id=upload class=box>
<form method=POST enctype=multipart/form-data action="{{ url_for("create", dirname=base_dir) }}">
	<label>upload:</label>
	<input type=file name=target /> <input type=submit value=upload name=what />
</form>
</div>
{% endif %}

<div id=curpath class=box>
	<label>current dir:</label>
	{% for name, path in cur_path_toks %}
		<a href={{ url_for("show", dirname=path) }}>{{ name }}</a> /
	{% endfor %}
</div><br />

{% if show_newdir %}
<div id=newdir class=box>
<form method=POST action="{{ url_for("create", dirname=base_dir) }}">
	<label>new dir:</label>
	<input type=text name=new_dirname /> <input type=submit value=add name=what />
</form>
</div>
{% endif %}


{% if show_dirs %}
<div id=dirs class=box><ul>
  {% if base_dir != "." %}
	<li>
		<a class=name href="{{ url_for("show", dirname=parent_path) }}">..</a>
		<a class=action>&nbsp;</a>
	</li>
	{% endif %}
	{% for target, path in dirs %}
	<li>
		<a class=name href="{{ url_for("show", dirname=path) }}">{{ target }}</a>
		<a class=action href="{{ url_for("delete", target=path) }}">delete</a>
	</li>
	{% endfor %}
</ul></div>
{% endif %}
<br />


{% if show_files and files %}
<div id=files class=box>
<ul>
{% for target, path, filesize in files %}
	<li class=file_item>
  	<a class=name href="{{ url_for("get_file", target=path) }}">{{ target }}</a>
		<span class=info>{{ filesize }}</span>
		<a class=action href="{{ url_for("delete", target=path) }}">delete</a>
		{% if show_editor and path == editor_target %}
  		<form method=POST action="{{ url_for("create", dirname=base_dir) }}" name="editor">
  		<input type=hidden name=filename value="{{ target }}" />
	  	<input type=hidden name=contents value="" />
			<input type=submit value=save name=what />
	  	</form>
		{% else %}
  		<a class=action href="{{ url_for("edit", target=path) }}">edit</a>
		{% endif %}
	</li>
	{% if show_editor and path == editor_target %}
	  <pre id="editor"></pre>
			<script src="{{ url_for("get_static", target="ace/src-min/ace.js") }}" type="text/javascript" charset="utf-8"></script>
	  <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      //editor.session.setMode("ace/mode/javascript");

			$(function() {
				$.ajax({
					type: "GET",
					url: "{{ url_for('get_raw_file', target=path) }}",
					error: function() {
						alert("error getting raw file contents... DO NOT SAVE (@todo)");
					},
					success: function(ret, url) {
						$("form[name=editor] input[name=contents]").val(ret);
						editor.setValue(ret);
						editor.clearSelection();
					}
				});

				$("form[name=editor] input[name=what]").click(function(ev) {
						$("form[name=editor] input[name=contents]").val(editor.getValue());
						//ev.preventDefault();
					  //alert($("form[name=editor] input[name=contents]").val());
				});

			});
	  </script>
	{% endif %}
{% endfor %}
</ul>
</div>
{% endif %}

</body>
