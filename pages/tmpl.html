<!doctype html>
<head lang=en>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Fancy Uploader Frontend</title>

	<script src="{{ url_for("get_static", target="jquery-3.4.1.min.js") }}"
		type="text/javascript" charset="utf-8"></script>
	<script src="{{ url_for("get_static", target="jquery.form.js") }}"
		type="text/javascript" charset="utf-8"></script>
	<script src="{{ url_for("get_static", target="jsgrid/dist/jsgrid.min.js") }}"
		type="text/javascript" charset="utf-8"></script>
	<script src="{{ url_for("get_static", target="ace/src-min/ace.js") }}"
		type="text/javascript" charset="utf-8"></script>

	<link rel="stylesheet" href="{{ url_for("get_static",
											target="jsgrid/dist/jsgrid-theme.min.css") }}" />
	<link rel="stylesheet" href="{{ url_for("get_static",
											target="jsgrid/dist/jsgrid.min.css") }}" />
	<link rel="stylesheet" href="{{ url_for("get_static",
											target="style.css") }}" />

	<script src="{{ url_for("get_static", target="main.js") }}"
		type="text/javascript" charset="utf-8"></script>

</head>
<script>

	var url_prefix = "{{ url_prefix }}";

	var current_dir = "{{ base_dir }}";
	// hack, @fixme
	if (current_dir == ".")
			current_dir = "";

	{% for msg in messages %}
		show_message("{{msg}}");
	{% endfor %}

	var uid2item = new Object({});
	var uid2grid_id = new Object({});
	var uid_editing = null;

	var editor = null;

</script>

<body>

<article>
	<div id=curpath class=toplvlbox></div>
</article>

<main>

	<article>
		<div id=dirs class=toplvlbox></div>
		<div id=files class=toplvlbox></div>
	</article>

	<article>
		<div id=tools class=toplvlbox>

			<div id=newdir class=sublvlbox>
			  <form method=POST action="{{ url_for("create", dirname=base_dir) }}"
			  			name=newdir>
				  <label>new directory:</label>
				  <input type=text name=new_dirname value=""/>
				  <input type=submit value=create name=what />
			  </form>
		  </div>

 		  <div id=upload class=sublvlbox>
 			  <form method=POST enctype=multipart/form-data method="post"
				  	  action="{{ url_for("create", dirname=base_dir) }}" name=upload>
				  <label>upload file:</label>
				  <input type=file name=target />
					<input type=hidden name=what value=upload />
				  <input type=submit value=upload name=what />
			  </form>
		  </div>

			<!--div id=pastebinlink class=sublvlbox>
				<form method=GET action="{{ url_for("pastebin") }}" name=newpaste>
					<input type=submit value="new pastebin" name=what />
				</form>
			</div-->
			<div id=editor_ctrl class=sublvlbox>
				<form method=GET name=editor_ctrl action="{{ url_for("create", dirname=base_dir) }}">
					<label>editor control:</label>
					<input type=button name="new" value="new paste" />
					<input type=button name="clear" value="clear & close" />
					<input type=submit name="what" value="save data" />
		  		<input type=hidden name=data />
					<input type=hidden name=paste_from value=editor />
				</form>
			</div>
		</div>
	</article>

	<article>
		<div id=editorbox style="visibility: hidden; display: none;">
	  	<div id=editor></div>
		</div>
		<div id=previewbox style="visibility: hidden; display: none;">
			<img src="" />
		</div>
	</article>

	<article>
		<div id=flash class=toplvlbox></div>
	</article>

</main>

<script src="{{ url_for("get_static", target="end.js") }}"
	type="text/javascript" charset="utf-8"></script>

</body>

{#

{% if show_files and files %}
<div id=files class=box>
<ul>
{% for target, path, filesize in files %}
	<li class=file_item>
  	<a class=name href="{{ url_for("get_file", target=path) }}">{{ target }}</a>
		<span class=info>{{ filesize }}</span>
		<a class=action href="{{ url_for("delete", target=path) }}">delete</a>
		{% if show_editor and path == editor_target %}
  		<form method=POST action="{{ url_for("create", dirname=base_dir) }}" name="editor">
  		<input type=hidden name=filename value="{{ target }}" />
	  	<input type=hidden name=contents value="" />
			<input type=submit value=save name=what />
	  	</form>
		{% else %}
  		<a class=action href="{{ url_for("edit", target=path) }}">edit</a>
		{% endif %}
	</li>
	{% if show_editor and path == editor_target %}
	  <pre id="editor"></pre>
			<script src="{{ url_for("get_static", target="ace/src-min/ace.js") }}" type="text/javascript" charset="utf-8"></script>
	  <script>
      //editor.session.setMode("ace/mode/javascript");

			$(function() {
				$.ajax({
					type: "GET",
					url: "{{ url_for('get_raw_file', target=path) }}",
					error: function() {
						show_message("error getting raw file contents... DO NOT SAVE (@todo)", true);
					},
					success: function(ret, url) {
						$("form[name=editor] input[name=contents]").val(ret);
						editor.setValue(ret);
						editor.clearSelection();
					}
				});
			});

	  </script>
	{% endif %}
{% endfor %}
</ul>
</div>
{% endif %}
#}


